# 腾讯云安全组配置指南

## 🚨 紧急配置 - SSH端口2222

在执行安全修复脚本后，您需要立即在腾讯云控制台配置安全组，否则将无法连接服务器！

## 📋 配置步骤

### 1. 登录腾讯云控制台
1. 访问：https://console.cloud.tencent.com/
2. 登录您的腾讯云账户

### 2. 进入云服务器管理
1. 在控制台首页，找到并点击"云服务器"
2. 或者直接访问：https://console.cloud.tencent.com/cvm/instance

### 3. 找到您的服务器实例
- **实例ID**: `ins-bvr7rxtw`
- **IP地址**: `106.53.134.90`

### 4. 配置安全组规则

#### 方式一：快速配置（推荐）
1. 在实例列表中找到您的服务器
2. 点击实例ID或进入"详情"页面
3. 点击"安全组"选项卡
4. 点击"编辑规则"
5. 添加以下入站规则：

| 协议 | 端口 | 来源 | 策略 | 备注 |
|------|------|------|------|------|
| TCP | 2222 | 0.0.0.0/0 | 允许 | SSH新端口 |
| TCP | 80 | 0.0.0.0/0 | 允许 | HTTP |
| TCP | 443 | 0.0.0.0/0 | 允许 | HTTPS |

#### 方式二：详细配置
1. 左侧菜单选择"安全组"
2. 找到您服务器关联的安全组
3. 点击"编辑规则"
4. 在"入站规则"中添加：

```
类型: 自定义TCP
协议端口: 2222
来源: 0.0.0.0/0
策略: 允许
备注: SSH新端口 - 安全修复后
```

### 5. 验证配置
配置完成后，测试新的SSH连接：

```bash
# 使用新端口连接
ssh -p 2222 root@106.53.134.90

# 如果使用密钥文件
ssh -p 2222 -i /path/to/your/key root@106.53.134.90
```

## 🔒 安全组最佳实践

### 推荐的入站规则配置

| 协议 | 端口 | 来源 | 策略 | 说明 |
|------|------|------|------|------|
| TCP | 2222 | 您的IP/32 | 允许 | SSH（限制为您的IP） |
| TCP | 80 | 0.0.0.0/0 | 允许 | HTTP |
| TCP | 443 | 0.0.0.0/0 | 允许 | HTTPS |
| ICMP | - | 0.0.0.0/0 | 允许 | Ping |

### 安全建议
1. **限制SSH访问**：建议将SSH端口来源设置为您的固定IP，而不是0.0.0.0/0
2. **删除22端口**：确保删除原有的22端口规则
3. **最小权限原则**：只开放必要的端口

## 🛡️ 额外安全措施

### 1. 启用DDoS防护
在云服务器详情页面，启用DDoS防护

### 2. 配置域名解析
如果使用域名，确保DNS解析正确指向新的服务配置

### 3. SSL证书配置
如果使用HTTPS，确保SSL证书配置正确

## ⚠️ 紧急联系方式

如果配置过程中遇到问题：

1. **腾讯云客服**：400-013-2233
2. **工单系统**：控制台右上角"提交工单"
3. **在线客服**：控制台右下角客服图标

## 📞 常见问题

### Q1: 配置安全组后仍无法连接？
**A**: 检查以下项目：
- 安全组规则是否已保存
- 端口号是否正确（2222）
- 服务器防火墙是否正确配置
- SSH服务是否正常运行

### Q2: 忘记新端口号怎么办？
**A**: 
1. 通过腾讯云VNC控制台登录服务器
2. 查看SSH配置：`grep Port /etc/ssh/sshd_config`

### Q3: 需要恢复22端口吗？
**A**: 
建议不要恢复22端口，保持使用2222端口以增强安全性

## 🔧 自动化配置脚本

如果您熟悉腾讯云API，可以使用以下命令行工具：

```bash
# 安装腾讯云CLI
pip install tencentcloud-sdk-python

# 配置安全组规则（需要配置密钥和地域）
# 具体API调用请参考腾讯云API文档
```

---

## ✅ 配置完成检查清单

- [ ] 已在安全组中添加2222端口规则
- [ ] 已删除或禁用22端口规则
- [ ] 能够通过新端口SSH连接服务器
- [ ] 网站和应用正常访问
- [ ] fail2ban服务正常运行
- [ ] 防火墙规则正确配置

**重要提醒**: 配置完成后请立即测试连接，确保能够正常访问服务器！ 